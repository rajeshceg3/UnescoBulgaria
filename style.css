:root {
    --color-bg-start: #0f172a; /* Slate 900 */
    --color-bg-end: #1e293b;   /* Slate 800 */
    --color-text-primary: #f8fafc; /* Slate 50 */
    --color-text-secondary: #cbd5e1; /* Slate 300 */
    --color-accent: #d4af37;   /* Metallic Gold */
    --color-accent-glow: rgba(212, 175, 55, 0.4);
    --color-glass: rgba(30, 41, 59, 0.7);
    --color-glass-border: rgba(255, 255, 255, 0.1);

    --font-heading: 'Playfair Display', serif;
    --font-body: 'Poppins', sans-serif;

    --transition-speed: 0.8s;
    --transition-timing: cubic-bezier(0.2, 0.8, 0.2, 1); /* Ease-out quart-ish */
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

body {
    font-family: var(--font-body);
    background-color: var(--color-bg-start);
    color: var(--color-text-primary);
    height: 100vh;
    overflow: hidden; /* Prevent scrolling on desktop main view */
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: default; /* We might add a custom cursor later */
}

/* === CUSTOM CURSOR (Optional Polish) === */
/* Implementing a simple CSS cursor for links */
a, button, .site-node, .back-button {
    cursor: pointer;
}

/* === LOADER === */
#loader {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--color-bg-start);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    transition: opacity 0.8s ease;
}

.spinner {
    width: 60px;
    height: 60px;
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-top-color: var(--color-accent);
    border-radius: 50%;
    animation: spin 1s cubic-bezier(0.4, 0, 0.2, 1) infinite;
    box-shadow: 0 0 20px var(--color-accent-glow);
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

body.loaded #loader {
    opacity: 0;
    pointer-events: none;
}

/* === BACKGROUND & PATTERN === */
.background-canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    background: radial-gradient(circle at center, var(--color-bg-end), var(--color-bg-start));
}

.geometric-pattern {
    position: absolute;
    width: 100%;
    height: 100%;
    /* Subtle dot pattern */
    background-image: radial-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px);
    background-size: 30px 30px;
    opacity: 0.3;
    animation: background-drift 120s linear infinite;
}

@keyframes background-drift {
    0% { background-position: 0 0; }
    100% { background-position: 30px 30px; }
}

/* === APP CONTAINER === */
#app-container {
    width: 100%;
    height: 100%;
    position: relative;
    overflow: hidden;
}

/* === SECTIONS === */
#orrery-view, #detail-view {
    position: absolute;
    width: 100%;
    height: 100%;
    transition: opacity var(--transition-speed) var(--transition-timing),
                transform var(--transition-speed) var(--transition-timing),
                visibility var(--transition-speed);
}

/* === ORRERY VIEW (DESKTOP) === */
#orrery-view {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 10;
    pointer-events: none; /* Let clicks pass through to map */
}

.main-header {
    text-align: center;
    position: relative;
    z-index: 20;
    margin-bottom: 4vh;
    animation: fadeSlideDown 1.5s var(--transition-timing) forwards;
    pointer-events: auto; /* Re-enable clicks */
}

.main-header h1 {
    font-family: var(--font-heading);
    font-size: clamp(3rem, 6vw, 5rem);
    font-weight: 400;
    letter-spacing: 0.05em;
    background: linear-gradient(to right, #fff, #cbd5e1);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 0.2em;
}

.main-header p {
    font-size: clamp(0.8rem, 1.5vw, 1rem);
    letter-spacing: 0.4em;
    text-transform: uppercase;
    color: var(--color-accent);
    opacity: 0.9;
}

#heritage-orrery {
    position: relative;
    width: 50vh;
    height: 50vh;
    max-width: 500px;
    max-height: 500px;
    display: flex;
    justify-content: center;
    align-items: center;
    /* Subtle rotation of the entire system */
    animation: orbit-system 240s linear infinite;
    pointer-events: auto; /* Re-enable interactions */
}

/* The central sun/core */
.orrery-core {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, #fff, var(--color-accent));
    box-shadow: 0 0 50px var(--color-accent-glow), inset 0 0 20px rgba(255,255,255,0.8);
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 10;
}

/* Orbit rings */
.orbit-ring {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    border: 1px solid rgba(255, 255, 255, 0.05);
    border-radius: 50%;
    pointer-events: none;
}

.site-node {
    position: absolute;
    top: 50%;
    left: 50%;
    margin: -8px; /* Center the node itself (16px / 2) */
    width: 16px;
    height: 16px;
    background: #fff;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
    border: none;
    transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    z-index: 20;
}

/* Counter-rotate the nodes so labels stay upright if we were rotating the container,
   but here we might just rotate the container. Actually, if we rotate the container,
   labels will spin. Better UX: Keep nodes static relative to screen,
   or counter-rotate. For now, let's keep the slow rotation but make labels appear on hover. */

.site-node::after {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    border-radius: 50%;
    border: 1px solid var(--color-accent);
    opacity: 0;
    transform: scale(0.5);
    transition: all 0.3s ease;
}

.site-node:hover {
    transform: scale(1.5);
    background: var(--color-accent);
    box-shadow: 0 0 25px var(--color-accent);
}

.site-node:hover::after {
    opacity: 1;
    transform: scale(1);
}

.node-label {
    position: absolute;
    left: 50%;
    bottom: 25px; /* Above the node */
    transform: translateX(-50%) translateY(10px);
    background: rgba(15, 23, 42, 0.9);
    color: var(--color-text-primary);
    padding: 6px 12px;
    border-radius: 4px;
    font-size: 14px;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: all 0.3s ease;
    border: 1px solid rgba(255,255,255,0.1);
    font-family: var(--font-heading);
    letter-spacing: 0.05em;
}

.site-node:hover .node-label {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
}

/* === MAP CONTAINER === */
#map-container {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 35vh;
    opacity: 0; /* Hidden by default in Orrery view unless we want it visible */
    /* Let's make it visible but subtle in Orrery view?
       Actually, the plan said "Integrate the map better".
       Let's keep it fixed at the bottom but styled nicely.
    */
    transform: translateY(20px);
    transition: all var(--transition-speed) var(--transition-timing);
    z-index: 5;
    background: linear-gradient(to top, var(--color-bg-start), transparent);
    pointer-events: none; /* Pass through clicks to background if empty */
}

/* Make map interactive only when needed or if we change the design.
   For now, let's keep the original logic: hidden until detail view?
   Original: hidden. New plan: "Integrate it better... maybe as a background layer".
   Let's try making it a subtle footer in Orrery view.
*/
#map-container {
    opacity: 1;
    transform: translateY(0);
    height: 30vh;
    mask-image: linear-gradient(to bottom, transparent, black 20%);
    -webkit-mask-image: linear-gradient(to bottom, transparent, black 20%);
    pointer-events: all;
}

#map {
    width: 100%;
    height: 100%;
    background: transparent;
}

/* Custom Tooltip for Map */
.custom-map-tooltip {
    background: var(--color-bg-start);
    border: 1px solid var(--color-accent);
    color: var(--color-text-primary);
    font-family: var(--font-body);
    font-size: 12px;
    border-radius: 4px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.5);
}
.leaflet-tooltip-top:before {
    border-top-color: var(--color-accent);
}

/* === DETAIL VIEW === */
#detail-view {
    opacity: 0;
    visibility: hidden;
    z-index: 20;
    background: rgba(15, 23, 42, 0.95); /* High opacity backdrop */
    backdrop-filter: blur(10px);
    overflow-y: auto; /* Allow scrolling */
}

body.detail-active #detail-view {
    opacity: 1;
    visibility: visible;
}

body.detail-active #orrery-view {
    transform: scale(0.95);
    opacity: 0;
    pointer-events: none;
}

.back-button {
    position: fixed;
    top: 40px;
    left: 40px;
    width: 50px;
    height: 50px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.3);
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: all 0.3s ease;
    z-index: 50;
    backdrop-filter: blur(5px);
}

.back-button:hover {
    border-color: var(--color-accent);
    color: var(--color-accent);
    transform: scale(1.1);
}

.detail-content {
    max-width: 1400px;
    margin: 0 auto;
    padding: 100px 5vw;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 80px;
    align-items: start;
    min-height: 100vh;
}

.detail-image-container {
    position: sticky;
    top: 100px;
    width: 100%;
    height: 70vh;
    border-radius: 4px;
    overflow: hidden;
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
}

.detail-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 10s ease;
}

.detail-image-container:hover .detail-image {
    transform: scale(1.05);
}

.detail-text {
    padding-top: 20px;
}

#detail-title {
    font-family: var(--font-heading);
    font-size: clamp(3rem, 5vw, 4.5rem);
    line-height: 1.1;
    margin-bottom: 0.5em;
    color: var(--color-accent);
}

.detail-meta {
    display: flex;
    gap: 20px;
    margin-bottom: 40px;
    font-size: 0.9rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--color-text-secondary);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    padding-bottom: 20px;
}

#detail-description {
    font-size: 1.1rem;
    line-height: 1.8;
    margin-bottom: 40px;
    color: var(--color-text-primary);
}

#detail-significance {
    font-family: var(--font-heading);
    font-style: italic;
    font-size: 1.4rem;
    line-height: 1.6;
    color: #fff;
    border-left: 3px solid var(--color-accent);
    padding-left: 20px;
    margin-bottom: 40px;
}

#detail-link {
    display: inline-block;
    color: var(--color-accent);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color 0.3s;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

#detail-link:hover {
    border-bottom-color: var(--color-accent);
}

/* === USER CONTRIBUTIONS === */
.user-contributions {
    margin-top: 60px;
    padding-top: 40px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.user-contributions h3 {
    font-family: var(--font-heading);
    font-size: 2rem;
    margin-bottom: 30px;
    color: var(--color-text-primary);
}

#contributions-container {
    display: grid;
    gap: 20px;
    margin-bottom: 40px;
}

.story {
    background: var(--color-glass);
    padding: 20px;
    border-radius: 8px;
    border: 1px solid var(--color-glass-border);
}

.story h4 {
    color: var(--color-accent);
    margin-bottom: 10px;
    font-family: var(--font-heading);
}

.story p {
    font-size: 0.95rem;
    color: var(--color-text-secondary);
    line-height: 1.6;
}

#contribution-form {
    background: rgba(255, 255, 255, 0.03);
    padding: 30px;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

#contribution-form h4 {
    margin-bottom: 10px;
    font-family: var(--font-heading);
    font-size: 1.5rem;
}

#contribution-form input,
#contribution-form textarea {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.1);
    padding: 15px;
    border-radius: 4px;
    color: #fff;
    font-family: var(--font-body);
    transition: border-color 0.3s;
}

#contribution-form input:focus,
#contribution-form textarea:focus {
    outline: none;
    border-color: var(--color-accent);
}

#contribution-form button {
    background: var(--color-accent);
    color: var(--color-bg-start);
    padding: 15px;
    border: none;
    border-radius: 4px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    transition: background 0.3s, transform 0.2s;
}

#contribution-form button:hover {
    background: #fff;
    transform: translateY(-2px);
}

/* === ANIMATIONS === */
@keyframes fadeSlideDown {
    from { opacity: 0; transform: translateY(-30px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes orbit-system {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* === MOBILE HYPER-OPTIMIZATION === */
@media (max-width: 900px) {
    /* Change layout completely for mobile */
    #orrery-view {
        justify-content: flex-start;
        padding-top: 10vh;
        overflow-y: auto;
        height: auto;
        min-height: 100%;
        display: block; /* Allow normal flow */
        pointer-events: auto; /* Enable scrolling on mobile */
    }

    .main-header {
        margin-bottom: 2rem;
        transform: none;
        animation: none;
        padding: 0 20px;
    }

    .main-header h1 {
        font-size: 2.5rem;
    }

    /* Disable the rotating orrery on mobile */
    #heritage-orrery {
        width: 100%;
        height: auto;
        max-width: none;
        max-height: none;
        display: flex;
        flex-direction: column;
        align-items: stretch;
        animation: none;
        padding: 0 20px 100px 20px; /* Padding for scroll */
        gap: 15px;
        transform: none !important; /* Override inline styles */
    }

    .orrery-core, .orbit-ring {
        display: none; /* Hide the core and rings */
    }

    /* Transform nodes into cards */
    .site-node {
        position: relative; /* Not absolute anymore */
        width: 100%;
        height: auto;
        min-height: 80px;
        transform: none !important; /* Override inline styles */
        left: auto !important;
        top: auto !important;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px;
        box-shadow: none;
        margin: 0 0 10px 0;
    }

    .site-node:hover {
        transform: scale(1.02) !important;
        background: rgba(255, 255, 255, 0.1);
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    /* Adjust label for card layout */
    .node-label {
        position: static;
        transform: none;
        opacity: 1;
        background: transparent;
        border: none;
        font-size: 1.1rem;
        pointer-events: auto;
        padding: 0;
        text-align: left;
    }

    /* Add an arrow icon via CSS */
    .site-node::after {
        content: 'â†’';
        position: static;
        width: auto;
        height: auto;
        border: none;
        opacity: 0.5;
        font-size: 1.2rem;
        color: var(--color-accent);
        transform: none;
        border-radius: 0;
    }
    .site-node:hover::after {
        opacity: 1;
        transform: translateX(5px);
    }

    /* Map on Mobile */
    #map-container {
        display: none; /* Hide map on initial mobile view to focus on list */
    }

    /* Detail View Mobile */
    .detail-content {
        grid-template-columns: 1fr;
        padding: 0;
        gap: 0;
    }

    .detail-image-container {
        position: relative;
        top: 0;
        height: 50vh;
        border-radius: 0;
        box-shadow: none;
    }

    .detail-text {
        padding: 30px 20px 80px 20px;
        background: var(--color-bg-start);
        position: relative;
        top: -20px; /* Overlap image slightly */
        border-radius: 20px 20px 0 0;
        box-shadow: 0 -10px 30px rgba(0,0,0,0.3);
    }

    .back-button {
        top: 20px;
        left: 20px;
        background: rgba(0, 0, 0, 0.5);
    }

    body.detail-active #orrery-view {
        display: none; /* Completely remove to prevent scroll issues */
    }
}
